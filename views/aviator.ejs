<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aviator | CashMash</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/aviator.css" />
  <script>
    window.user = <% - JSON.stringify(user) %>;
  </script>
</head>

<body>
  <%- include('partials/header') %>

    <%- include('partials/gameLoader') %>


      <section class="aviator-section">
        <div class="aviator-header">
          <div class="neon-title">CashMash Aviator</div>
        </div>

        <!-- MAIN GAME AREA -->
        <div class="aviator-table">
          <div class="flight-area">
            <div class="flight-info">
              <div class="multiplier-display" id="multiplierDisplay">
                <span id="multiplier">1.00x</span>
              </div>
              <div class="result small-result" id="resultText"></div>
            </div>
            <div class="sunburst-container">
              <div class="sunburst"></div>
            </div>
            <div class="flight-path"></div>
            <svg id="graph-svg" class="graph-svg"></svg>
            <div class="plane" id="plane"></div>
          </div>

          <!-- CONTROLS AREA -->
          <div class="controls">
            <div class="control-line">
              <div class="balance-container">
                Balance: $<strong id="balance" data-raw-balance="<%= user.balance %>">
                  <%= formatBalance(user.balance) %>
                </strong>
              </div>
              <input id="betAmount" type="number" min="5" max="100" value="5" />
              <button id="placeBetBtn" class="btn gold">Place Bet</button>
              <button id="cashOutBtn" class="btn gold" disabled>Cash Out</button>
            </div>
          </div>
        </div>
      </section>

      <%- include('partials/footer') %>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/formatBalance.js"></script>
        <script src="/js/aviator.js"></script>
        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const betInput = document.getElementById("betAmount");
            const placeBetBtn = document.getElementById("placeBetBtn");

            const MIN_BET = 5;
            const MAX_BET = 100;

            // Auto-correct when user leaves the field
            betInput.addEventListener("blur", () => {
              let value = parseInt(betInput.value, 10);

              if (isNaN(value)) {
                betInput.value = MIN_BET;
                return;
              }

              if (value < MIN_BET) betInput.value = MIN_BET;
              if (value > MAX_BET) betInput.value = MAX_BET;
            });

            // Extra safety: validate on click
            placeBetBtn.addEventListener("click", (e) => {
              const value = parseInt(betInput.value, 10);

              if (value < MIN_BET || isNaN(value)) {
                e.preventDefault();
                alert(`Minimum bet: $${MIN_BET}`);
                betInput.value = MIN_BET;
                return;
              }

              if (value > MAX_BET) {
                e.preventDefault();
                alert(`Maximum bet: $${MAX_BET}`);
                betInput.value = MAX_BET;
                return;
              }

              // valid â†’ aviator.js will continue automatically
            });
          });
        </script>


</body>

</html>