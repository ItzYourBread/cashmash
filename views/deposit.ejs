<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        Deposit Title Placeholder | CashMash
    </title>

    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link rel="stylesheet" href="/css/payment.css" />
</head>

<body>
    <%- include('partials/header') %>

        <section class="dashboard">
            <div class="dashboard-container">

                <aside class="sidebar">
                    <div class="balance-box">
                        <h3>
                            Balance
                        </h3>
                        <% if (user) { %>
                            <p>$<%= user.balance.toLocaleString() %>
                            </p>
                            <% } else { %>
                                <p>
                                    Login to see balance
                                </p>
                                <% } %>
                    </div>

                    <ul class="sidebar-menu">
                        <li class="active" data-tab="ewallets">
                            E-Wallets
                        </li>
                        <li data-tab="crypto">
                            Crypto
                        </li>
                        <li data-tab="bank">
                            Bank
                        </li>
                    </ul>
                </aside>

                <div class="content-area">

                    <div id="ewallets" class="content-section active">
                        <h2>
                            E-Wallets
                        </h2>
                        <div class="payment-cards">
                            <div class="payment-card" data-modal="modal-bkash">
                                <img src="/images/payments/bkash.jpg" alt="Bkash">
                                <h4>Bkash</h4>
                            </div>
                            <div class="payment-card" data-modal="modal-nagad">
                                <img src="/images/payments/nagad.jpg" alt="Nagad">
                                <h4>Nagad</h4>
                            </div>
                            <div class="payment-card" data-modal="modal-upay">
                                <img src="/images/payments/upay.jpg" alt="Upay">
                                <h4>Upay</h4>
                            </div>
                            <div class="payment-card" data-modal="modal-binance">
                                <img src="/images/payments/binance.jpg" alt="Binance">
                                <h4>BinancePay</h4>
                            </div>
                        </div>
                    </div>

                    <div id="crypto" class="content-section">
                        <h2>
                            Crypto
                        </h2>

                        <div class="payment-cards">
                            <% if (availableCryptos && availableCryptos.length) { %>
                                <% availableCryptos.forEach(c=> {
                                    const currency = c.toLowerCase();
                                    const displayName = currency.toUpperCase().replace('USDT', 'USDT-');
                                    const icon = `${currency}.jpg`;
                                    %>
                                    <div class="payment-card" data-modal="modal-crypto" data-currency="<%= currency %>">
                                        <img src="/images/payments/<%= icon %>" alt="<%= displayName %>">
                                        <h4>
                                            <%= displayName %>
                                        </h4>
                                    </div>
                                    <% }) %>
                                        <% } else { %>
                                            <p>No available cryptos.</p>
                                            <% } %>
                        </div>
                    </div>

                    <div id="modal-crypto" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h3 id="cryptoTitle">
                                Crypto Deposit (NOWPayments)
                            </h3>
                            <form method="POST" action="/deposit/crypto">
                                <input type="hidden" name="currency" id="cryptoCurrency" value="">
                                <label>
                                    Amount (USD)
                                </label>
                                <input type="number" name="amount" id="cryptoAmount" required min="10" max="1000" />
                                <div id="cryptoFeedback" class="amount-feedback"></div>

                                <p>
                                    You will be redirected to a crypto payment page.
                                </p>
                                <button type="submit" disabled>
                                    Pay with Crypto
                                </button>
                            </form>
                        </div>
                    </div>

                    <div id="bank" class="content-section">
                        <h2>
                            Bank
                        </h2>
                        <div class="payment-cards">
                        </div>
                        <h2 style="margin-top: 20px;">
                            Coming Soon...
                        </h2>
                    </div>

                </div>
            </div>
        </section>

        <div id="modal-bkash" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>
                    Bkash Deposit
                </h3>
                <% const bkashAgents=agentPayments['Bkash']; const randomBkashAgent=bkashAgents[Math.floor(Math.random()
                    * bkashAgents.length)]; %>
                    <h4>
                        Send money to:
                    </h4>
                    <p><strong>
                            <%= randomBkashAgent.full_name %>
                        </strong>: <%= randomBkashAgent.contact %>
                    </p>
                    <form method="POST" action="/deposit/bkash">
                        <label>
                            Amount (USD)
                        </label>
                        <input type="number" name="amount" id="bkashAmount" required min="300" max="25000">
                        <div id="bkashFeedback" class="amount-feedback"></div>

                        <label>
                            Transaction ID
                        </label>
                        <input type="text" name="transactionId" required>
                        <p>
                            After sending money, please enter the Transaction ID above to confirm your deposit. Deposits may take up to 5 minutes to reflect.
                        </p>
                        <button type="submit" disabled>
                            Confirm
                        </button>
                    </form>
            </div>
        </div>

        <div id="modal-nagad" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>
                    Nagad Deposit
                </h3>
                <% const nagadAgents=agentPayments['Nagad']; const randomNagadAgent=nagadAgents[Math.floor(Math.random()
                    * nagadAgents.length)]; %>
                    <h4>
                        Send money to:
                    </h4>
                    <p><strong>
                            <%= randomNagadAgent.full_name %>
                        </strong>: <%= randomNagadAgent.contact %>
                    </p>
                    <form method="POST" action="/deposit/nagad">
                        <label>
                            Amount (USD)
                        </label>
                        <input type="number" name="amount" id="nagadAmount" required min="300" max="25000">
                        <div id="nagadFeedback" class="amount-feedback"></div>

                        <label>
                            Transaction ID
                        </label>
                        <input type="text" name="transactionId" required>
                        <p>
                            After sending money, please enter the Transaction ID above to confirm your deposit. Deposits may take up to 5 minutes to reflect.
                        </p>
                        <button type="submit" disabled>
                            Confirm
                        </button>
                    </form>
            </div>
        </div>

        <div id="modal-upay" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>
                    Upay Deposit
                </h3>
                <% const upayAgents=agentPayments['Upay']; const randomUpayAgent=upayAgents[Math.floor(Math.random() *
                    upayAgents.length)]; %>
                    <h4>
                        Send money to:
                    </h4>
                    <p><strong>
                            <%= randomUpayAgent.full_name %>
                        </strong>: <%= randomUpayAgent.contact %>
                    </p>
                    <form method="POST" action="/deposit/upay">
                        <label>
                            Amount (USD)
                        </label>
                        <input type="number" name="amount" id="upayAmount" required min="300" max="25000">
                        <div id="upayFeedback" class="amount-feedback"></div>

                        <label>
                            Transaction ID
                        </label>
                        <input type="text" name="transactionId" required>
                        <p>
                            After sending money, please enter the Transaction ID above to confirm your deposit. Deposits may take up to 5 minutes to reflect.
                        </p>
                        <button type="submit" disabled>
                            Confirm
                        </button>
                    </form>
            </div>
        </div>

        <div id="modal-binance" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>
                    BinancePay Deposit
                </h3>
                <form method="POST" action="/deposit/binance" id="binanceForm">
                    <label>
                        Amount (USD)
                    </label>
                    <input type="number" name="amount" id="binanceAmount" required min="5" max="500" step="0.01">
                    <div id="binanceFeedback" class="amount-feedback"></div>

                    <input type="hidden" name="bdtAmount" id="binanceBdtAmount">

                    <label>
                        Order ID
                    </label>
                    <input type="text" name="txnId" required placeholder="Enter your Order ID" />
                    <p>
                        After sending money, please enter the Order ID above to confirm your deposit. Deposits may take up to 5 minutes to reflect.
                    </p>
                    <button type="submit" disabled>
                        Confirm
                    </button>
                </form>
            </div>
        </div>

        <div class="login-modal" id="loginModal">
            <div class="login-modal-content">
                <h2>
                    Login Required
                </h2>
                <p>
                    You need to be logged in to deposit balance.
                </p>
                <div class="login-modal-actions">
                    <a href="/login" class="login-btn gold">
                        Login
                    </a>
                    <button class="login-btn outline" id="closeLoginModal">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>
            <script>
                // Server-side user login check logic is retained
                const isLoggedIn = <%= user ? 'true' : 'false' %>;

            </script>
            <script src="/js/deposit.js"></script>
</body>

</html>